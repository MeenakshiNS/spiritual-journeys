<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supplier Details</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      padding: 30px;
      background: #f9fafb;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    input, button, select {
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #search {
      flex-grow: 1;
      max-width: 400px;
    }

    .table-container {
      overflow-x: auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background: white;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      min-width: 800px;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
      white-space: nowrap;
      font-size: 14px;
    }
    th {
      background: #f3f4f6;
      font-weight: bold;
    }

    form {
      margin-top: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    form button[type="submit"] {
      grid-column: 1 / -1;
      background: #10b981;
      color: white;
      cursor: pointer;
      border: none;
      padding: 10px;
    }
    #saveBtn {
      margin: 15px auto 0;
      display: block;
      background: #f59e0b;
      color: white;
      border: none;
      cursor: pointer;
      width: 100%;
      max-width: 200px;
    }
    .action-btn {
      cursor: pointer;
      padding: 4px 8px;
      border: none;
      border-radius: 5px;
      color: white;
      margin: 2px;
      font-size: 12px;
    }
    .edit-btn {
      background: #2563eb;
    }
    .delete-btn {
      background: #dc2626;
    }

    .json-editor-container {
      margin-top: 30px;
      padding: 15px;
      background: #ffffff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    #jsonEditor {
      width: 100%;
      min-height: 200px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      border: 1px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
    }
    .json-editor-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .json-editor-controls button {
      flex-grow: 1;
    }
    #loadJsonBtn {
      background: #059669;
      color: white;
    }
    #updateEditorBtn {
      background: #f97316;
      color: white;
    }

    @media (max-width: 600px) {
      body {
        padding: 15px;
        margin: 0;
      }
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      #search {
        max-width: 100%;
      }
      form {
        grid-template-columns: 1fr;
      }
      th, td {
        padding: 8px;
      }
    }
  </style>
</head>
<body>

  <h1>üì¶ Supplier Details</h1>

  <div class="controls">
    <input type="text" id="search" placeholder="Search by city, company or type...">
    <button id="sortBtn">Sort A-Z by City</button>
  </div>

  <div class="table-container">
    <table id="companyTable">
      <thead>
        <tr>
          <th>SI No</th>
          <th>Type</th>
          <th>City</th>
          <th>Company Name</th>
          <th>Contact Name</th>
          <th>Contact Number</th>
          <th>Email ID</th>
          <th>Website</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <h2>Add/Update Supplier</h2>
  <form id="addForm">
    <select id="type" required>
      <option value="" disabled selected>Select Type</option>
      <option value="Domestic">Domestic</option>
      <option value="International">International</option>
    </select>
    <input type="text" id="city" placeholder="City" required>
    <input type="text" id="company" placeholder="Company Name" required>
    <input type="text" id="contactName" placeholder="Contact Name" required>
    <input type="text" id="contactNumber" placeholder="Contact Number" required>
    <input type="email" id="email" placeholder="Email ID" required>
    <input type="text" id="website" placeholder="Website" required>
    <button type="submit">Add / Update Entry</button>
  </form>

  <div class="json-editor-container">
    <h2>JSON Data Editor (For bulk editing/loading)</h2>
    <textarea id="jsonEditor"></textarea>
    <div class="json-editor-controls">
      <button id="updateEditorBtn">üìù Load Current Data to Editor</button>
      <button id="loadJsonBtn">üì§ Save JSON from Editor to Table</button>
    </div>
  </div>

  <button id="saveBtn">üíæ Download JSON File</button>

  <script>
    const initialData = [
      { type: "Domestic", city: "Mumbai", company: "India Steel Co.", contactName: "Rajesh K.", contactNumber: "9876543210", email: "rajesh@indiasteel.in", website: "http://indiasteel.in" },
      { type: "International", city: "Berlin", company: "EuroParts GmbH", contactName: "Lena Schmidt", contactNumber: "+49301234567", email: "lena@europarts.de", website: "http://europarts.com" },
      { type: "Domestic", city: "Delhi", company: "Capital Chem Ltd.", contactName: "Priya Sharma", contactNumber: "9000111222", email: "priya@capitalchem.in", website: "http://capitalchem.in" }
    ];

    let companies = JSON.parse(localStorage.getItem('companies')) || initialData;
    let editIndex = null;

    const tableBody = document.getElementById('tableBody');
    const searchInput = document.getElementById('search');
    const sortBtn = document.getElementById('sortBtn');
    const form = document.getElementById('addForm');
    const saveBtn = document.getElementById('saveBtn');
    const jsonEditor = document.getElementById('jsonEditor');
    const loadJsonBtn = document.getElementById('loadJsonBtn');
    const updateEditorBtn = document.getElementById('updateEditorBtn');

    function renderTable(data = companies) {
      tableBody.innerHTML = "";
      data.forEach((item, index) => {
        const originalIndex = companies.indexOf(item);
        const row = `
          <tr>
            <td>${index + 1}</td>
            <td>${item.type}</td>
            <td>${item.city}</td>
            <td>${item.company}</td>
            <td>${item.contactName}</td>
            <td>${item.contactNumber}</td>
            <td>${item.email}</td>
            <td><a href="${item.website}" target="_blank">${item.website}</a></td>
            <td>
              <button class="action-btn edit-btn" onclick="editEntry(${originalIndex})">Edit</button>
              <button class="action-btn delete-btn" onclick="deleteEntry(${originalIndex})">Delete</button>
            </td>
          </tr>`;
        tableBody.insertAdjacentHTML('beforeend', row);
      });
    }

    function saveToLocal() {
      localStorage.setItem('companies', JSON.stringify(companies));
    }

    loadJsonBtn.addEventListener('click', () => {
      try {
        const newCompanies = JSON.parse(jsonEditor.value);
        if (Array.isArray(newCompanies)) {
          companies = newCompanies;
          saveToLocal();
          renderTable();
          alert('‚úÖ Successfully loaded and saved new data from JSON Editor!');
        } else {
          throw new Error('JSON is not a valid array.');
        }
      } catch (e) {
        alert('‚ùå ERROR: Invalid JSON format. ' + e.message);
      }
    });

    updateEditorBtn.addEventListener('click', () => {
      jsonEditor.value = JSON.stringify(companies, null, 2);
    });

    form.addEventListener('submit', e => {
      e.preventDefault();
      const newEntry = {
        type: form.type.value,
        city: form.city.value.trim(),
        company: form.company.value.trim(),
        contactName: form.contactName.value.trim(),
        contactNumber: form.contactNumber.value.trim(),
        email: form.email.value.trim(),
        website: form.website.value.trim()
      };

      if (editIndex !== null) {
        companies[editIndex] = newEntry;
        editIndex = null;
        form.querySelector('button[type="submit"]').textContent = "Add / Update Entry";
      } else {
        companies.push(newEntry);
      }

      saveToLocal();
      form.reset();
      renderTable();
    });

    window.editEntry = function(index) {
      const c = companies[index];
      if (!c) return;
      form.type.value = c.type;
      form.city.value = c.city;
      form.company.value = c.company;
      form.contactName.value = c.contactName;
      form.contactNumber.value = c.contactNumber;
      form.email.value = c.email;
      form.website.value = c.website;
      editIndex = index;
      form.querySelector('button[type="submit"]').textContent = "Update Entry";
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    };

    window.deleteEntry = function(index) {
      if (confirm("Are you sure you want to delete this entry?")) {
        companies.splice(index, 1);
        saveToLocal();
        renderTable();
      }
    };

    searchInput.addEventListener('input', e => {
      const val = e.target.value.toLowerCase();
      const filtered = companies.filter(c =>
        c.city.toLowerCase().includes(val) ||
        c.company.toLowerCase().includes(val) ||
        c.type.toLowerCase().includes(val)
      );
      renderTable(filtered);
    });

    let sortAsc = true;
    sortBtn.addEventListener('click', () => {
      companies.sort((a, b) =>
        sortAsc ? a.city.localeCompare(b.city) : b.city.localeCompare(a.city)
      );
      sortAsc = !sortAsc;
      sortBtn.textContent = sortAsc ? "Sort A-Z by City" : "Sort Z-A by City";
      saveToLocal();
      renderTable();
    });

    saveBtn.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(companies, null, 2)], { type: "application/json" });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = "supplier_details.json";
      link.click();
    });

    renderTable();
    updateEditorBtn.click();
  </script>

</body>
</html>
